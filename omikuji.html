<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ä¸€æŠ½é–‹é‹é˜¿é­¯æ–¯</title>
    <link href="https://fonts.googleapis.com/css2?family=New+Tegomin&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* ==================== å­—é«”è¨­å®š ==================== */
        @font-face {
            font-family: 'FTT-Chiaro B';
            /* è«‹ç¢ºä¿é€™äº›å­—å‹æª”æ¡ˆåœ¨æ‚¨çš„è³‡æ–™å¤¾ä¸­ */
            src: url('others/FTT-Chiaro B.woff') format("woff"),
                 url('others/FTT-Chiaro B.ttf') format("truetype"),
                 url('others/FTT-Chiaro B.eot') format("embedded-opentype");
        }

        /* å…¨åŸŸå­—é«”è¨­å®šï¼Œçµ±ä¸€ä¿®æ­£ç‚º FTT-Chiaro B */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #e6195d 0%, #c8197c 4%, #7a1557 19%, #f05387,#d460a7,#cecece), url("others/gd181443_-8.jpg"), rgba(165, 164, 164, 0.8);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-blend-mode: multiply;
            color: #281c1c;
            font-family: 'FTT-Chiaro B', 'New Tegomin', sans-serif; /* çµ±ä¸€å­—é«” */
            font-size: 22px;
            text-align: center;
            text-shadow: -0.9px -0.9px 0 #f6e6e1bd, 0.9px -0.9px 0 #f6e6e1bd, -0.9px 0.9px 0 #f6e6e1bd, 0.9px 0.9px 0 #f6e6e1bd, 1.5px 1.5px 2.6px #928181;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background-image: url("others/gd181443_-81.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            text-align: left;
            padding-bottom: 20px;
        }

        header h1 {
            color: #54011dd7;
            text-align: center;
        }

        header h1#main-title {
            position: relative;
            color: transparent;
            text-shadow: none;
            background-image: linear-gradient(to bottom right, #e76eaa 13%, #ca508d 35%, #54011dd7 85%); /* å¾å·¦ä¸Šåˆ°å³ä¸‹çš„æ¼¸å±¤ */
            -webkit-background-clip: text;
            background-clip: text;
            text-align: right;
            margin-right: 5%;

            filter: drop-shadow(-0.5px -0.5px 0 #f6e6e1bd)
                    drop-shadow(0.5px -0.5px 0 #f6e6e1bd)
                    drop-shadow(-0.5px 0.5px 0 #f6e6e1bd)
                    drop-shadow(0.5px 0.5px 0 #f6e6e1bd)
                    drop-shadow(1.3px 1.3px 2.4px #928181);
        }

        header h1#main-title::after {
            content: attr(data-text); /* ä½¿ç”¨ data-text å±¬æ€§å…§å®¹ */
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1; /* ç¢ºä¿é™°å½±åœ¨æ–‡å­—ä¸‹æ–¹ */
            /* å¥—ç”¨æ‚¨æä¾›çš„é™°å½±æ ¼å¼ */
            text-shadow: -0.9px -0.9px 0 #f6e6e1bd,
                0.9px -0.9px 0 #f6e6e1bd,
                -0.9px 0.9px 0 #f6e6e1bd,
                0.9px 0.9px 0 #f6e6e1bd, 1.5px 1.5px 2.6px #928181;
        }

        footer {
            color: #21010cd7;
            font-size: 14px;
            margin: 0;
            padding: 0;
            background: linear-gradient(to top, transparent, #9f1313f7), url("others/124435362_p01.png");
            background-color: #9f1313f7; /* ä½œç‚º fallback è‰²ï¼Œä»¥é˜²æ¼¸å±¤æœªæ­£å¸¸é¡¯ç¤º */
            background-size: cover; /* è®“åœ–ç‰‡è¦†è“‹æ•´å€‹å®¹å™¨ */
            background-position: center; /* è®“åœ–ç‰‡ç½®ä¸­ */
            background-repeat: no-repeat; /* åœ–ç‰‡ä¸é‡è¤‡ */
            background-blend-mode: multiply; /* æ··åˆæ¨¡å¼ */
            text-align: center;
            position: relative; /* é—œéµä¿®æ­£ï¼šè®“å½å…ƒç´ å¯ä»¥ç›¸å°å®šä½ */
            
        }

        footer a {
            font-size: 14px;
            color: #21010cd7; /* ä½¿ç”¨æ–°çš„è¶…é€£çµé¡è‰²è®Šæ•¸ */
            text-shadow: -0.9px -0.9px 0 #f6e6e1bd,
                         0.9px -0.9px 0 #f6e6e1bd,
                         -0.9px 0.9px 0 #f6e6e1bd,
                         0.9px 0.9px 0 #f6e6e1bd, 1.5px 1.5px 2.6px #928181;
        }

        /* ==================== æŠ½ç±¤é é¢æ¨£å¼ ==================== */

        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* é€šç”¨å¡ç‰‡æ¨£å¼ (çµ¦ç±¤ç­’å’Œçµæœå…±ç”¨) */
        .card-style {
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border: 2px solid #ebd0d5;
            margin-bottom: 20px;
            position: relative;
            /* ä¿®æ­£3: å·²ç§»é™¤æ–œç·šèƒŒæ™¯æ•ˆæœ (::before) */
        }

        /* --- ç±¤ç­’å€åŸŸ --- */
        #draw-section {
            /* ä¿®æ­£1: çµ¦ç±¤ç­’ä¹ŸåŠ ä¸Šç™½è‰²èƒŒæ™¯æ¡† */
            max-width: 400px;
            width: 100%;
            transition: transform 0.2s;
        }

        /* åªæœ‰åœ–ç‰‡å¯ä»¥é»æ“Š */
        .clickable-box {
            cursor: pointer;
            display: inline-block;
            transition: transform 0.2s;
        }
        .clickable-box:hover {
            transform: scale(1.05);
        }

        .omikuji-box-img {
            width: 250px;
            height: auto;
            /* åœ–ç‰‡é™°å½±æ•ˆæœ */
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }

        .shake-animation {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); }
            40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); }
        }

        .instruction-text {
            font-size: 1.2em;
            color: #555;
            margin: 10px 0 5px 0;
            font-weight: bold;
        }

        .limit-text {
            font-size: 0.9em;
            color: #dd0000;
            margin: 0;
        }

        /* --- çµæœå€åŸŸ --- */
        #result-section {
            display: none;
            width: 100%;
            max-width: 500px;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-content {
            position: relative;
            z-index: 1;
        }

        .result-title {
            font-size: 2em;
            color: #dd0000;
            margin: 10px 0;
        }

        /* ä¿®æ­£4: çµæœåœ–ç‰‡æ¨£å¼èª¿æ•´ */
        .result-image {
            width: 80%;
            max-width: 300px;
            height: auto;
            margin: 10px 0;
            /* ç§»é™¤åŸæœ¬çš„ border */
            border: none; 
            border-radius: 0;
            /* æ”¹ç”¨ drop-shadowï¼Œè®“éæ­£æ–¹å½¢åœ–ç‰‡åªæœ‰åœ–æ¡ˆæœ‰é™°å½± */
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        .result-text-box {
            background-color: #fafafa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-size: 1.1em;
            color: #555;
            position: relative;
            /* ä¿®æ­£5: ä¿®æ­£å…§æ–‡å­—å‹ */
            font-family: 'FTT-Chiaro B', 'New Tegomin', sans-serif;
            line-height: 1.6;
        }

        /* ç”¨æ–¼é«˜äº®é‹å‹¢æ–‡å­— (ç´…è‰²) */
        .highlight-red {
            color: #dd0000;
            font-weight: bold;
        }

        .notice-container {
            margin: 15px 0;
            /* ä¿®æ­£7: å°‡ã€Œæ˜å¤©å†ä¾†ã€æ–‡å­—å€å¡Šæ¨£å¼å„ªåŒ–ï¼Œä¸èˆ‡ä¸Šæ–¹å¡ç‰‡æ²¾é» */
        }

        .notice-text {
            font-size: 12px;
            color: #dd0000;
            margin-top: 10px;
            background-color: rgba(255,255,255,0.8);
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* --- æŒ‰éˆ•ç¾¤çµ„ --- */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: 10px;
        }

        .btn {
            padding: 10px 0; /* ä¸Šä¸‹ paddingï¼Œå·¦å³ç”±å¯¬åº¦æ§åˆ¶ */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'FTT-Chiaro B', 'New Tegomin', sans-serif;
            font-size: 14px;
            transition: all 0.3s;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            
            /* ä¿®æ­£6: è¨­å®šä¸€è‡´çš„å¯¬åº¦ */
            width: 160px; /* å›ºå®šå¯¬åº¦ï¼Œæˆ–æ˜¯ç”¨ flex-basis */
            flex: 0 0 auto;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn-copy { background-color: #dd0000; }
        .btn-copy:hover { background-color: #a00000; }

        .btn-twitter { background-color: #1DA1F2; }
        .btn-twitter:hover { background-color: #0c85d0; }

        .btn-discord { background-color: #5865F2; }
        .btn-discord:hover { background-color: #4752c4; }

        .btn-save { background-color: #2c3e50; }
        .btn-save:hover { background-color: #1a252f; }

        /* RWD èª¿æ•´ */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
                text-align: center;
                margin-right: 0;
            }
            .omikuji-box-img {
                width: 200px;
            }
            .btn {
                width: 45%; /* æ‰‹æ©Ÿç‰ˆä¸¦æ’ */
            }
        }
        @media (max-width: 400px) {
            .btn {
                width: 100%; /* æ¥µå°è¢å¹•å‚ç›´æ’åˆ— */
            }
        }

       /* ==================== Header å³å´è³‡è¨Šæ¸…å–®æ¨£å¼ ==================== */
        
        /* åˆ—è¡¨å®¹å™¨ï¼šå®šä½åœ¨å³å´ */
        .header-info-list {
            position: absolute; /* çµ•å°å®šä½ï¼Œè®“å®ƒå¯ä»¥ç–Šåœ¨ Header èƒŒæ™¯ä¸Š */
            right: 7.3%;          /* èˆ‡æ¨™é¡Œ (h1) çš„ margin-right: 5% å°é½Š */
            top: 158px;         /* è·é›¢é ‚éƒ¨çš„é«˜åº¦ï¼Œè«‹ä¾æ‚¨çš„æ¨™é¡Œé«˜åº¦å¾®èª¿ */
            
            list-style: none;   /* ç§»é™¤é è¨­åœ“é» */
            padding: 0;
            margin: 0;
            
            /* è®“åˆ—è¡¨å…§çš„é …ç›®å‚ç›´æ’åˆ— */
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* è®“å…§éƒ¨æ–‡å­—é å·¦å°é½Š */
            
            z-index: 10;
        }

        /* åˆ—è¡¨é …ç›®æ¨£å¼ - åƒè€ƒ index.html çš„é‚è¼¯ */
        .header-info-list li {
            position: relative;   /* ç‚ºäº†è®“å…§éƒ¨çš„ ::before (åœ–ç‰‡) å¯ä»¥å®šä½ */
            font-family: 'FTT-Chiaro B', sans-serif;
            font-size: 16px;
            color: #54011dd7;     /* æ·±ç´…è‰²å­—é«” */
            margin-bottom: 8px;   /* è¡Œè· */
            
            padding-left: 25px;   /* å·¦å´ç•™ç™½çµ¦åœ–ç‰‡ Icon */
            padding-right: 10px;  /* å³å´ç¨å¾®ç•™é»ç©ºé–“ */
            
        }
        /* ä½¿ç”¨å½å…ƒç´ ä¾†é¡¯ç¤ºåœ–ç‰‡ Icon (others/4752.png) */
        .header-info-list li::before {
            content: '';
            display: inline-block;
            width: 18px;          /* åœ–ç‰‡å¯¬åº¦ */
            height: 18px;         /* åœ–ç‰‡é«˜åº¦ */
            
            /* è¨­å®šåœ–ç‰‡è·¯å¾‘ */
            background-image: url('others/4752.png'); 
            background-size: contain;
            background-repeat: no-repeat;
            
            position: absolute;   /* çµ•å°å®šä½ */
            left: 5px;            /* é å·¦å®šä½ (é…åˆ li çš„ padding-left) */
            top: 50%;             /* å‚ç›´ç½®ä¸­ */
            transform: translateY(-50%); /* ä¿®æ­£å‚ç›´ç½®ä¸­çš„åç§» */
        }

        /* RWD æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 768px) {
            .header-info-list {
                position: static; /* æ‰‹æ©Ÿç‰ˆå–æ¶ˆçµ•å°å®šä½ï¼Œæ”¹ç‚ºæµå‹•æ’ç‰ˆ */
                width: 100%;
                align-items: center; /* ç½®ä¸­å°é½Š */
                margin-top: 10px;
                padding-bottom: 10px;
            }
            
            .header-info-list li {
                background-color: rgba(255, 255, 255, 0.8); /* æ‰‹æ©Ÿç‰ˆèƒŒæ™¯æ·±ä¸€é» */
            }
        }
    </style>
</head>
<body>

    <header>
        <p><b><br></b></p>
        <h1 id="main-title">æ¯æ—¥é–‹é‹é˜¿é­¯æ–¯ã€€</h1>
        <p><b><br><br><br></b></p>
        <p><b><br></b></p>
        <ul class="header-info-list">
            <li>æ¯æ—¥é ˜å–ä¸€éš»é–‹é‹é˜¿é­¯æ–¯</li>
            <li>æœ¬ç¶²é åƒ…ä¾›å¨›æ¨‚ï¼Œè¼•é¬†çœ‹å¾…çµæœ</li>
        </ul>
        </header>

        <br>

    <div class="main-container">
        
        <div id="draw-section" class="card-style">
            
            <div class="clickable-box" onclick="startDraw()">
                <img src="others/kuji.png" alt="é»æ“Šç±¤ç­’" class="omikuji-box-img" id="box-image" onerror="this.src='https://via.placeholder.com/250x300/dd0000/ffffff?text=ç±¤ç­’åœ–'">
            </div>
            
            <p class="instruction-text">é»æ“Šç±¤ç­’é–‹å§‹æŠ½ç±¤</p>
            <p class="limit-text">æ¯å¤©åªèƒ½æŠ½ä¸€æ¬¡å–”ï¼</p>
        </div>

        <div id="result-section">
            <div class="card-style" id="capture-area">
                <h2 class="result-title" id="result-title">å¤§å‰</h2>
                
                <img src="" alt="çµæœåœ–ç‰‡" class="result-image" id="result-image">
                
                <div class="result-text-box" id="result-text">
                    é‹å‹¢å…§å®¹è¼‰å…¥ä¸­...
                </div>
                
                <div style="font-size: 12px; color: #999; margin-top: 5px;">
                    æŠ½ç±¤æ—¥æœŸ: <span id="draw-date"></span>
                </div>
            </div>

            <br>

            <div class="notice-container">
                <p class="notice-text">æ˜å¤©å†ä¾†è©¦è©¦æ‰‹æ°£å§ï¼</p>
            </div>

            <div class="action-buttons">
                <button class="btn btn-copy" onclick="copyResultText()">
                    ğŸ“‹ è¤‡è£½æ–‡å­—
                </button>
                <button class="btn btn-twitter" onclick="shareTwitter()">
                    ğŸ¦ åˆ†äº«åˆ°æ¨ç‰¹
                </button>
                <button class="btn btn-discord" onclick="copyForDiscord()">
                    ğŸ’¬ Discordæ ¼å¼
                </button>
                <button class="btn btn-save" onclick="saveScreenshot()">
                    ğŸ“¸ æˆªåœ–ä¿å­˜
                </button>
            </div>

            <br><br>
        </div>

    </div>

    <footer>
        <br>
        <h4>copyright Â© 2025-2026 Incomplete Combustion.</h4>
        <span><a href="https://forms.gle/mJtxFZm2aotvbMHV6">è¯çµ¡æˆ‘</a>ï½œ<a href="https://tabakoshisutemu.github.io/IC._alst_emotecode/copyright">å…è²¬è²æ˜</a></span><br><br>
    </footer>

    <script>
        // ==================== è¨­å®šå€ ====================
        
        // ä¿®æ­£2: è¨­å®šéŸ³æ•ˆæª”æ¡ˆè·¯å¾‘ (è«‹æ”¾ç½®æ‚¨çš„éŸ³æ•ˆæª”)
        const CLICK_SOUND_PATH = 'others/syakasyaka.mp3'; 

        // [æ–°å¢] è¨­å®šçµæœå‡ºç¾æ™‚çš„éŸ³æ•ˆ (è«‹ä¿®æ”¹é€™è£¡çš„æª”æ¡ˆè·¯å¾‘)
        const RESULT_SOUND_PATH = 'others/jyanjyan.mp3';   // <--- æ–°å¢é€™ä¸€è¡Œ

        // è¨­å®šæŠ½ç±¤çµæœèˆ‡æ©Ÿç‡
        // ä¿®æ­£8: åœ¨ text ä¸­ï¼Œå°‡é‹å‹¢åç¨± (å¦‚å¤§å‰) ç”¨ <span class='highlight-red'> åŒ…èµ·ä¾†
        const drawConfig = [
            { 
                id: 1, 
                name: "à¼º è–¯å‰ à¼»", 
                rate: 5, 
                // é€™è£¡ç¤ºç¯„å¦‚ä½•å°‡é‹å‹¢æ–‡å­—è®Šç´…
                text: "ä½ çš„é‹å‹¢......ä»€éº¼ï¼æ˜¯<span class='highlight-red'>è–¯å‰</span>ï¼ï¼Ÿ<br>é€™ç¨®é‹å‹¢æˆ‘å¯ä¸çŸ¥é“......<br>ä¸–ç•Œä¸ŠçœŸçš„æ˜¯å……æ»¿æœªçŸ¥å•Š......", 
                image: "others/è–¯G.png" 
            },
            { 
                id: 2, 
                name: "à¼º å¤§å‰ à¼»", 
                rate: 15, 
                text: "ä½ çš„é‹å‹¢......å“‡ï¼æ˜¯<span class='highlight-red'>å¤§å‰</span>ï¼<br>çœ‹ä¾†ï¼Œåªè¦ä½ ä¸æ°£é¤’<br>ä¸€å®šèƒ½å¿ƒæƒ³äº‹æˆã€‚", 
                image: "others/å¤§G.png" 
            },
            { 
                id: 3, 
                name: "à¼º å‰ à¼»", 
                rate: 40, 
                text: "ä½ çš„é‹å‹¢......æ˜¯<span class='highlight-red'>å‰</span>å‘¢ï¼<br>æ‡‰è©²é‚„ä¸éŒ¯ã€‚<br>åªè¦è…³è¸å¯¦åœ°è¬äº‹éƒ½æœƒé †åˆ©ã€‚", 
                image: "others/G.png" 
            },
            { 
                id: 4, 
                name: "à¼º å°å‰ à¼»", 
                rate: 30, 
                text: "ä½ çš„é‹å‹¢......æ˜¯<span class='highlight-red'>å°å‰</span>ï¼<br>å±¬æ–¼ä¸ä¸Šä¸ä¸‹çš„é‚£ç¨®<br>çœ‹ä¾†ä¸è¦æŠ±å¤ªå¤§çš„å¸Œæœ›æ¯”è¼ƒå¥½ã€‚", 
                image: "others/å°G.png" 
            },
            { 
                id: 5, 
                name: "à¼º å…‡ à¼»", 
                rate: 10, 
                text: "ä½ çš„é‹å‹¢......å“å‘€å‘€ï¼Œæ˜¯<span class='highlight-red'>å…‡</span>ï¼<br>å…¶å¯¦ä¹Ÿä¸éŒ¯ï¼Œæ—¢ç„¶èƒ½äº‹å…ˆçŸ¥é“<br>å°±å¯ä»¥å¥½å¥½æº–å‚™å¦‚ä½•æ‡‰å°äº†ã€‚", 
                image: "others/X.png" 
            }
        ];

        // ==================== ç¨‹å¼é‚è¼¯å€ ====================

        const STORAGE_KEY = 'alst_daily_draw_v2'; // æ›´æ–°ç‰ˆæœ¬è™Ÿä»¥å…èˆ‡èˆŠè³‡æ–™è¡çª
        const drawSection = document.getElementById('draw-section');
        const resultSection = document.getElementById('result-section');
        const boxImage = document.getElementById('box-image');
        
        // é å…ˆè¼‰å…¥éŸ³æ•ˆç‰©ä»¶
        const drawAudio = new Audio(CLICK_SOUND_PATH);
        drawAudio.volume = 0.5; // éŸ³é‡è¨­å®š 50%

        // [æ–°å¢] å»ºç«‹çµæœéŸ³æ•ˆç‰©ä»¶
        const resultAudio = new Audio(RESULT_SOUND_PATH); // <--- æ–°å¢é€™ä¸€è¡Œ
        resultAudio.volume = 0.5;

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ˜¯å¦æŠ½é
        window.addEventListener('load', () => {
            const today = new Date().toLocaleDateString();
            const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY));

            if (savedData && savedData.date === today) {
                // å¦‚æœä»Šå¤©å·²ç¶“æŠ½éï¼Œç›´æ¥é¡¯ç¤ºçµæœ
                showResultScreen(savedData.result, today);

                // â–¼â–¼â–¼ è«‹æ–°å¢ä»¥ä¸‹é€™æ®µç¨‹å¼ç¢¼ â–¼â–¼â–¼
                
                // å˜—è©¦æ’­æ”¾çµæœéŸ³æ•ˆ
                // æ³¨æ„ï¼šå¤§å¤šæ•¸ç€è¦½å™¨æœƒé˜»æ“‹é‡æ–°æ•´ç†å¾Œçš„è‡ªå‹•æ’­æ”¾ï¼Œé™¤éä½¿ç”¨è€…å·²èˆ‡ç¶²é äº’å‹•é
                if (typeof resultAudio !== 'undefined') {
                    resultAudio.currentTime = 0;
                    resultAudio.play().catch(e => {
                        console.log("ç€è¦½å™¨é˜»æ“‹äº†è‡ªå‹•æ’­æ”¾ (æ­£å¸¸ç¾è±¡):", e);
                    });
                }
                
                // â–²â–²â–² æ–°å¢åˆ°é€™è£¡ç‚ºæ­¢ â–²â–²â–²
            }
        });

        function startDraw() {
            const today = new Date().toLocaleDateString();
            const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY));
            
            if (savedData && savedData.date === today) {
                alert("ä¸€å¤©åªèƒ½æŠ½ä¸€æ¬¡å–”ï¼");
                showResultScreen(savedData.result, today);
                return;
            }

            // ä¿®æ­£2: æ’­æ”¾éŸ³æ•ˆ
            drawAudio.currentTime = 0; // é‡ç½®éŸ³æ•ˆæ™‚é–“
            drawAudio.play().catch(e => console.log("ç€è¦½å™¨é˜»æ“‹è‡ªå‹•æ’­æ”¾ï¼Œéœ€ä½¿ç”¨è€…äº’å‹•:", e));

            // åŸ·è¡Œå‹•ç•«
            boxImage.classList.add('shake-animation');
            
            // 1.5ç§’å¾Œé¡¯ç¤ºçµæœ
            setTimeout(() => {
                boxImage.classList.remove('shake-animation');
                const result = calculateResult();
                
                // å„²å­˜çµæœ
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    date: today,
                    result: result
                }));

                showResultScreen(result, today);

                // [æ–°å¢] æ’­æ”¾çµæœéŸ³æ•ˆ
                resultAudio.currentTime = 0; // é‡ç½®æ™‚é–“ï¼Œç¢ºä¿æ¯æ¬¡éƒ½èƒ½å¾é ­æ’­
                resultAudio.play();          // <--- æ–°å¢é€™ä¸€è¡Œ
            }, 1500);
        }

        function calculateResult() {
            const totalRate = drawConfig.reduce((sum, item) => sum + item.rate, 0);
            let random = Math.random() * totalRate;
            
            for (const item of drawConfig) {
                if (random < item.rate) {
                    return item;
                }
                random -= item.rate;
            }
            return drawConfig[drawConfig.length - 1];
        }

        function showResultScreen(result, dateStr) {
            // éš±è—ç±¤ç­’ï¼Œé¡¯ç¤ºçµæœ
            drawSection.style.display = 'none';
            resultSection.style.display = 'block';

            // æ›´æ–° DOM
            document.getElementById('result-title').innerText = result.name;
            
            // åœ–ç‰‡è·¯å¾‘è‹¥å¤±æ•ˆï¼Œä½¿ç”¨ placeholder
            const imgEl = document.getElementById('result-image');
            imgEl.src = result.image;
            imgEl.onerror = function() { this.src = 'https://via.placeholder.com/300x300?text=' + result.name; };

            // ä½¿ç”¨ innerHTML ä»¥æ”¯æ´ <span class='highlight-red'>
            document.getElementById('result-text').innerHTML = result.text;
            document.getElementById('draw-date').innerText = dateStr;
        }

        // --- æŒ‰éˆ•åŠŸèƒ½ ---

        // 1. è¤‡è£½æ–‡å­— (é€™è£¡éœ€è¦éæ¿¾æ‰ HTML æ¨™ç±¤ä»¥å–å¾—ç´”æ–‡å­—)
        function copyResultText() {
            const title = document.getElementById('result-title').innerText;
            // å–å¾—ç´”æ–‡å­—å…§å®¹
            const textContent = document.getElementById('result-text').innerText;
            const content = `ã€${title}ã€‘<br>${textContent}<br>(ä¾†è‡ª: æ¯æ—¥ä¸€æŠ½é–‹é‹é˜¿é­¯æ–¯)`;
            
            navigator.clipboard.writeText(content).then(() => {
                alert('å·²è¤‡è£½ç±¤æ–‡ï¼');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
            });
        }

        // 2. åˆ†äº«åˆ° Twitter
        function shareTwitter() {
            const title = document.getElementById('result-title').innerText;
            const textContent = document.getElementById('result-text').innerText;
            const shareText = encodeURIComponent(`æˆ‘ä»Šå¤©æŠ½åˆ°äº†é–‹é‹é˜¿é­¯æ–¯ã€${title}ã€‘ï¼<br>${textContent}<br>#éŠé‡‘è¡“ç‰©èª #é–‹é‹é˜¿é­¯æ–¯`);
            const url = `https://twitter.com/intent/tweet?text=${shareText}`;
            window.open(url, '_blank');
        }

        // 3. è¤‡è£½ Discord æ ¼å¼
        function copyForDiscord() {
            const title = document.getElementById('result-title').innerText;
            const textContent = document.getElementById('result-text').innerText;
            const imgSrc = document.getElementById('result-image').src;
            
            const content = `**${title}**\n${textContent}\n${imgSrc}`;
            
            navigator.clipboard.writeText(content).then(() => {
                alert('å·²è¤‡è£½ Discord æ ¼å¼å…§å®¹ï¼\nè«‹ç›´æ¥åœ¨ Discord å°è©±æ¡†è²¼ä¸Š (Ctrl+V)ã€‚');
            });
        }

        // 4. æˆªåœ–ä¿å­˜
        function saveScreenshot() {
            const element = document.getElementById('capture-area');
            
            html2canvas(element, {
                backgroundColor: null, // ä¿æŒé€æ˜ (å› ç‚ºå¡ç‰‡æœ‰åœ“è§’)
                scale: 2 // æé«˜è§£æåº¦
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `daily_fortune_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>